CREATE VIEW "CONTACT_CENTER"."FIVE9"."VW_EMAIL_DETAILS" AS
(
SELECT
	"SESSION_GUID",
	"PARENT_SESSION_GUID",
	"DATE",
	"TIME",
	CASE WHEN PII_ACCESS = TRUE THEN "AGENT" ELSE sha2("AGENT", 512) END AS "AGENT",
	CASE WHEN PII_ACCESS = TRUE THEN "AGENT_FIRST_NAME" ELSE sha2("AGENT_FIRST_NAME", 512) END AS "AGENT_FIRST_NAME",
	"AGENT_GROUP",
	"AGENT_ID",
	CASE WHEN PII_ACCESS = TRUE THEN "AGENT_LAST_NAME" ELSE sha2("AGENT_LAST_NAME", 512) END AS "AGENT_LAST_NAME",
	CASE WHEN PII_ACCESS = TRUE THEN "AGENT_NAME" ELSE sha2("AGENT_NAME", 512) END AS "AGENT_NAME",
	CASE WHEN PII_ACCESS = TRUE THEN "ACCOUNT_NAME" ELSE sha2("ACCOUNT_NAME", 512) END AS "ACCOUNT_NAME",
	"CAMPAIGN",
	"CUSTOMER_ID",
	CASE WHEN PII_ACCESS = TRUE THEN "CUSTOMER_NAME" ELSE sha2("CUSTOMER_NAME", 512) END AS "CUSTOMER_NAME",
	"DISPOSITION",
	"ENGAGE_STATUS",
	CASE WHEN PII_ACCESS = TRUE THEN "FROM_ADDRESS" ELSE sha2("FROM_ADDRESS", 512) END AS "FROM_ADDRESS",
	"INTERACTION_TYPE",
	"INTERACTIONS",
	"MEDIA_SOURCE",
	"MEDIA_SUBTYPE",
	"MEDIA_TYPE",
	"MEDIA_VENDOR",
	"OUTREACH_IND",
	"SKILL",
	CASE WHEN PII_ACCESS = TRUE THEN "TO_ADDRESS" ELSE sha2("TO_ADDRESS", 512) END AS "TO_ADDRESS",
	"TRANSCRIPT_LINK",
	"WORK_ITEM_STATUS",
	"DECISION_TIME",
	"EMAIL_QUEUE_TIME",
	"EMAIL_TIME",
	"FCR_TIME",
	"HANDLE_TIME",
	"INTERACTION_TIME",
	"PREVIEW_ENGAGED",
	"PREVIEW_TIME",
	"PROACTIVE_OFFERS",
	"PROGRESS_TIME",
	"QUEUE_TIME",
	"RESOLUTION_TIME",
	"RESPONSE_TIME",
	"TIME_TILL_ACCEPT",
	"TRANSFERS",
	"TRANSFERS_TO_AGENT",
	"TRANSFERS_TO_CAMPAIGN",
	"TRANSFERS_TO_SKILL",
	"TIMESTAMP",
	"_ETL_FILENAME"
 FROM "CONTACT_CENTER"."FIVE9"."EMAIL_DETAILS"
 LEFT JOIN "DATAENG_UTILS"."MAPPINGS"."PII_MAPPINGS" PII ON PII.ROLE = CURRENT_ROLE()
);
